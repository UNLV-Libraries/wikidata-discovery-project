{% extends 'discover/base.html' %}
{% load static %}

{% block head-script %}
    <script type='text/javascript' src="{% static 'discover/filtered_head.js' %}"></script>
{% endblock %}

{% block header2 %}Information about People - <i>Search Results: "{{ string }}"</i> {% endblock %}

{% block main-content %}
    <form action="/discover/people_filtered/" method="post">
    {% csrf_token %}
        {{ search }}
    <input type="submit" value="SEARCH">
    </form>
    <div id="errors"> {{ errors }}</div>
    <p>People Returned: <b>{{ num }}</b></p>
    {% if filtered_people %}
          <table>
              <tr>
                  <td>DETAILS</td>
                  <td><strong>PERSON</strong></td>
                  <td><strong>ABOUT</strong></td>
            </tr>
            {% for p in filtered_people %}
                <tr>
                    <td><a href="/discover/item/{{ p.getitemid }}">details</a></td>
                    <td>{{ p.getlabel }}</td>
                    <td>{{ p.getdesc }}</td>
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No people returned from your search.</p>
    {% endif %}
{% endblock %}

{% block main-graph %}
    <div id="property_data" class="prop_data">{{ properties }}</div>
    <script type="text/javascript">
        let inbound_nodes = {{ nodes }};
        let inbound_edges = {{ edges }};
        let inbound_checks = {{ checks }};

        function showProperties(pitem_id) {
            try {
                let i_data = _.find(js_objects, function (o) //js_objects init on window load.
                    {return o.id === pitem_id;}, 0);
                if (i_data) {
                    if (i_data['label']) {
                        return i_data['label'];
                    } else {
                        let nm = "name: " + i_data.itemprops['itemlabel'];
                        let image = "image: " + i_data.itemprops['image'];
                        let dob = "date of birth: " + i_data.itemprops['dob'].substr(0, 10);
                        let pob = "place of birth: " + i_data.itemprops['placeofbirth'];
                        let dod = "date of death: " + i_data.itemprops['dateofdeath'].substr(0, 10);
                        let pod = "place of death: " + i_data.itemprops['placeofdeath'];
                        let mom = "mother: " + i_data.itemprops['mother'];
                        let dad = "father: " + i_data.itemprops['father'];
                        let sp = "spouse: " + i_data.itemprops['spouse'];
                        let ch = "child: " + i_data.itemprops['child'];
                        let rel = "relative: " + i_data.itemprops['relative'];
                        return nm + '\n' + image + '\n' + dob + '\n' + pob +
                            '\n' + dod + '\n' + pod + '\n' + mom + '\n' + dad +
                            '\n' + sp + '\n' + ch + '\n' + rel;
                    }
                } else {
                    return "";
                }
            } catch (err) {
                alert(err.message);
            }
        }
    function keepTT() {
        tooltip_div.hidden = 'false';
    }
    </script>
    <script type='text/javascript' src="{% static 'discover/graph_functions.js' %}"></script>

{% endblock %}
{% block side-map %}
    <p><strong>Interact with Graph</strong></p>
    <form id='node_form' action="/discover/people_filtered/" method="post">
        {% csrf_token %}
        {{ select }}
        <input type="submit" value="filter">
   </form>
    <div id="vis-tooltip" onpointerenter="keepTT()" ></div>
    <div id="vis-container">
    <div id="loading_graph" hidden="true">LOADING GRAPH DATA...</div>
    </div> {# used by inserted javascript as canvas #}
    <div id="selection_label"></div>

{% endblock %}